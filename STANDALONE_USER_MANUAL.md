# ATP_Re 單機版使用手冊
# ATP_Re Standalone User Manual

## 目錄 (Table of Contents)

1. [快速開始 (Quick Start)](#快速開始-quick-start)
2. [系統介面 (System Interface)](#系統介面-system-interface)
3. [檔案上傳 (File Upload)](#檔案上傳-file-upload)
4. [任務管理 (Task Management)](#任務管理-task-management)
5. [資料分析 (Data Analysis)](#資料分析-data-analysis)
6. [事件監控 (Event Monitoring)](#事件監控-event-monitoring)
7. [報表生成 (Report Generation)](#報表生成-report-generation)
8. [進階功能 (Advanced Features)](#進階功能-advanced-features)
9. [最佳實踐 (Best Practices)](#最佳實踐-best-practices)

---

## 快速開始 (Quick Start)

### 啟動系統

**Windows**:
1. 雙擊 `ATP_Re.exe`
2. 等待啟動完成（約 5-10 秒）
3. 瀏覽器自動開啟至 http://localhost:8501

**macOS**:
1. 開啟 `ATP_Re.app`
2. 等待啟動完成（約 5-10 秒）
3. 瀏覽器自動開啟至 http://localhost:8501

### 基本工作流程

```
1. 上傳資料檔案 → 2. 系統自動處理 → 3. 查看分析結果 → 4. 生成報表
```

### 第一次使用

1. **啟動系統**
   - 執行 ATP_Re 啟動器
   - 確認看到成功啟動訊息

2. **上傳測試檔案**
   - 點擊側邊欄「File Upload」
   - 選擇 ATP 資料檔案（.dat, .log, .bin 等）
   - 點擊「Upload」按鈕

3. **查看處理結果**
   - 前往「Dashboard」查看任務狀態
   - 任務完成後可以查看分析結果

4. **探索功能**
   - 瀏覽各個功能頁面
   - 熟悉介面操作

---

## 系統介面 (System Interface)

### 主畫面佈局

```
┌─────────────────────────────────────────────┐
│  🚆 ATP_Re - 自動列車防護行車紀錄分析系統    │  ← 標題列
├───────┬─────────────────────────────────────┤
│       │                                     │
│ [側邊]│         主內容區域                   │  ← 內容區
│ [選單]│                                     │
│       │                                     │
└───────┴─────────────────────────────────────┘
```

### 導航選單

**側邊欄包含以下功能頁面**:

| 圖示 | 功能 | 說明 |
|------|------|------|
| 📊 | Dashboard | 系統儀表板，總覽所有任務 |
| 📁 | File Upload | 上傳 ATP 資料檔案 |
| 📋 | Task Management | 管理處理任務 |
| 📈 | Data Analysis | 資料分析與視覺化 |
| 🔔 | Event Monitoring | 事件監控與告警 |
| 📄 | Reports | 報表生成與匯出 |

### 操作區域

- **頂部導航**: 快速切換功能頁面
- **主內容區**: 顯示當前頁面內容
- **側邊欄**: 功能選單和篩選選項
- **狀態列**: 顯示系統狀態和通知

---

## 檔案上傳 (File Upload)

### 支援的檔案格式

ATP_Re 支援以下格式：

| 格式 | 副檔名 | 說明 |
|------|--------|------|
| 二進位資料 | .dat | ATP 原始資料檔案 |
| 日誌檔案 | .log | 系統日誌檔案 |
| 文字檔案 | .txt | 文字格式資料 |
| 二進位檔案 | .bin | 其他二進位格式 |
| 壓縮檔案 | .zip | 包含多個檔案的壓縮包 |

### 上傳步驟

1. **選擇檔案**
   ```
   File Upload 頁面
   ├─ 點擊「Choose a file」或拖曳檔案至上傳區
   ├─ 選擇本地檔案
   └─ 確認檔案資訊正確
   ```

2. **設定選項**
   - ✅ **Automatically create processing task**: 自動建立處理任務
     - 勾選: 上傳後立即開始處理
     - 不勾選: 僅上傳檔案，稍後手動建立任務

3. **開始上傳**
   - 點擊「Upload」按鈕
   - 等待上傳完成
   - 查看上傳結果

### 檔案大小限制

- **預設上限**: 100MB
- **建議大小**: < 50MB 可獲得最佳效能
- **大檔案處理**: 建議分批上傳或壓縮

### 上傳後的操作

上傳成功後，系統會顯示：

```json
{
  "id": 123,
  "filename": "atp_data_20241028.dat",
  "size": 12345678,
  "status": "uploaded",
  "task_created": true,
  "task_id": 456
}
```

可以：
1. **前往 Dashboard** 查看處理進度
2. **前往 Task Management** 管理任務
3. **繼續上傳** 其他檔案

---

## 任務管理 (Task Management)

### 任務類型

| 類型 | 說明 | 用途 |
|------|------|------|
| decode | 解碼任務 | 解析原始 ATP 資料 |
| analyze | 分析任務 | 資料分析與計算 |
| report | 報表任務 | 生成分析報表 |
| export | 匯出任務 | 匯出處理結果 |

### 任務狀態

| 狀態 | 圖示 | 說明 |
|------|------|------|
| pending | ⏳ | 等待處理 |
| processing | 🔄 | 正在處理 |
| completed | ✅ | 處理完成 |
| failed | ❌ | 處理失敗 |

### 查看任務列表

**Task List 標籤頁**:

1. **篩選任務**
   - 使用「Filter by status」下拉選單
   - 選擇要查看的狀態（All / pending / processing / completed / failed）

2. **查看任務詳情**
   - 點擊任務展開詳細資訊
   - 查看任務類型、狀態、建立時間
   - 查看關聯的檔案路徑

3. **操作任務**
   - 「View Details」: 查看完整詳情
   - 其他操作視任務狀態而定

### 建立新任務

**Create Task 標籤頁**:

1. **填寫任務資訊**
   ```
   Task Name: [輸入任務名稱]
   Task Type: [選擇任務類型]
   Description: [輸入描述（可選）]
   ```

2. **點擊 Create Task**
   - 確認任務已建立
   - 系統返回任務 ID 和詳情

3. **追蹤任務進度**
   - 返回 Task List 查看新任務
   - 監控處理狀態

### 任務管理最佳實踐

1. **命名規範**
   - 使用描述性名稱: `ATP_分析_20241028_車次1234`
   - 包含日期和關鍵資訊

2. **定期清理**
   - 刪除已完成的舊任務
   - 保留重要的分析結果

3. **監控失敗任務**
   - 檢查失敗原因
   - 必要時重新處理

---

## 資料分析 (Data Analysis)

### 選擇任務

1. **前往 Data Analysis 頁面**
2. **從下拉選單選擇任務**
   - 顯示格式: `Task #[ID]: [任務名稱]`
3. **點擊「Load Data」載入資料**

### 資料統計

載入資料後，系統顯示：

```
┌──────────────┬──────────────┬──────────────┬──────────────┐
│ Data Points  │  Avg Speed   │  Max Speed   │  Time Range  │
│    10,000    │   85.5 km/h  │  120.0 km/h  │   02:30:00   │
└──────────────┴──────────────┴──────────────┴──────────────┘
```

### 視覺化圖表

#### 1. 速度時間圖 (Speed Over Time)

**功能**: 顯示列車速度隨時間變化

**解讀**:
- **X 軸**: 時間戳記
- **Y 軸**: 速度 (km/h)
- **曲線**: 速度變化趨勢

**用途**:
- 識別加速/減速區段
- 發現異常速度變化
- 分析行車模式

#### 2. 位置時間圖 (Position Over Time)

**功能**: 顯示列車位置隨時間變化

**解讀**:
- **X 軸**: 時間戳記
- **Y 軸**: 位置 (公里標)
- **曲線**: 位置變化（應為單調遞增）

**用途**:
- 驗證行程完整性
- 計算行駛距離
- 識別停車點

### 資料表格

**Data Table 區域**:

- **顯示**: 完整資料表格
- **欄位**: timestamp, speed, position, 等
- **功能**:
  - 排序: 點擊欄位標題
  - 搜尋: 使用表格上方搜尋框
  - 匯出: 下載為 CSV 格式

### 互動功能

1. **縮放圖表**
   - 使用滑鼠滾輪或雙指縮放
   - 拖曳查看不同時段

2. **懸停提示**
   - 滑鼠移至資料點查看詳細數值

3. **圖例控制**
   - 點擊圖例項目顯示/隱藏資料系列

---

## 事件監控 (Event Monitoring)

### 事件類型

ATP 系統記錄多種事件：

| 類別 | 事件類型 | 嚴重性 |
|------|----------|--------|
| 操作 | 按鈕操作 | Info |
| 通訊 | 通訊錯誤 | High |
| 煞車 | 緊急煞車 | Critical |
| 警報 | 超速警報 | High |
| 系統 | 系統故障 | Critical |

### 嚴重性等級

| 等級 | 圖示 | 顏色 | 說明 |
|------|------|------|------|
| Critical | 🔴 | 紅色 | 立即需要處理 |
| High | 🟠 | 橙色 | 重要事件 |
| Medium | 🟡 | 黃色 | 需要關注 |
| Low | 🟢 | 綠色 | 一般資訊 |
| Info | 🔵 | 藍色 | 僅供參考 |

### 篩選事件

1. **選擇任務**
   - 從下拉選單選擇要監控的任務

2. **設定嚴重性篩選**
   - 使用「Filter by severity」多選框
   - 勾選要顯示的嚴重性等級
   - 預設: Critical, High

3. **載入事件**
   - 點擊「Load Events」

### 事件摘要

**視覺化圖表**:

1. **依嚴重性統計**
   - 長條圖顯示各等級事件數量
   - 快速識別問題嚴重程度

2. **事件類型排行**
   - 顯示前 10 種最常見事件
   - 了解主要問題類型

3. **事件時間軸**
   - 折線圖顯示事件隨時間分布
   - 識別問題集中時段

### 查看事件詳情

**Recent Events 區域**:

展開事件卡片查看:
```
🔴 緊急煞車 - 2024-10-28 14:23:45
────────────────────────────────
Message: 列車超速，觸發緊急煞車
Details: 
  - 當前速度: 125 km/h
  - 限速: 100 km/h
  - 位置: 1234.5 km
  - 司機員: D001
```

### 事件處理

1. **Critical 事件**: 立即調查原因
2. **High 事件**: 記錄並追蹤
3. **Medium/Low**: 定期檢視
4. **Info**: 參考資訊

---

## 報表生成 (Report Generation)

### 報表類型

| 類型 | 內容 | 適用場景 |
|------|------|----------|
| summary | 摘要報表 | 快速總覽 |
| detailed | 詳細報表 | 深入分析 |
| analysis | 分析報表 | 專業分析 |

### 報表格式

| 格式 | 優點 | 缺點 |
|------|------|------|
| PDF | 通用、易分享 | 檔案較大 |
| Excel | 可編輯、分析 | 需要 Excel |
| HTML | 可互動、美觀 | 需要瀏覽器 |

### 生成報表

**步驟**:

1. **選擇任務**
   ```
   Select Task: [選擇要生成報表的任務]
   ```

2. **設定報表選項**
   ```
   Report Type: [summary / detailed / analysis]
   Format: [pdf / excel / html]
   ☑ Include Charts: 包含視覺化圖表
   ```

3. **生成報表**
   - 點擊「Generate Report」
   - 等待處理完成
   - 系統顯示結果和下載連結

### 報表內容

#### Summary Report (摘要報表)

**包含**:
- 任務基本資訊
- 資料統計摘要
- 主要事件列表
- 關鍵指標

**適用**:
- 日常檢視
- 管理層報告
- 快速評估

#### Detailed Report (詳細報表)

**包含**:
- 完整資料表格
- 所有事件詳情
- 詳細統計資料
- 時間序列分析

**適用**:
- 深入調查
- 技術分析
- 存檔備查

#### Analysis Report (分析報表)

**包含**:
- 專業分析結論
- 趨勢分析
- 異常檢測
- 改善建議

**適用**:
- 專業評估
- 研究分析
- 決策支援

### 快速摘要

**View Task Summary 功能**:

- 不需要生成完整報表
- 快速查看關鍵資訊
- JSON 格式顯示

---

## 進階功能 (Advanced Features)

### API 存取

ATP_Re 提供完整的 REST API：

**API 文檔**: http://localhost:8000/docs

#### 常用 API 端點

| 端點 | 方法 | 功能 |
|------|------|------|
| `/api/v1/tasks/` | GET | 取得任務列表 |
| `/api/v1/tasks/` | POST | 建立新任務 |
| `/api/v1/data/task/{id}` | GET | 取得任務資料 |
| `/api/v1/events/task/{id}` | GET | 取得任務事件 |
| `/api/v1/upload/` | POST | 上傳檔案 |

#### 使用範例

**Python**:
```python
import requests

# API 基礎 URL
API_BASE = "http://localhost:8000/api/v1"

# 取得任務列表
response = requests.get(f"{API_BASE}/tasks/")
tasks = response.json()

# 建立新任務
data = {
    "task_name": "測試任務",
    "task_type": "analyze",
    "description": "API 建立的測試任務"
}
response = requests.post(f"{API_BASE}/tasks/", json=data)
result = response.json()
```

**cURL**:
```bash
# 健康檢查
curl http://localhost:8000/health

# 取得任務列表
curl http://localhost:8000/api/v1/tasks/

# 建立任務
curl -X POST http://localhost:8000/api/v1/tasks/ \
  -H "Content-Type: application/json" \
  -d '{"task_name":"測試","task_type":"analyze"}'
```

### 批次處理

**處理多個檔案**:

1. **上傳多個檔案**
   - 重複上傳步驟
   - 每個檔案建立獨立任務

2. **監控批次進度**
   - 使用 Dashboard 總覽
   - 篩選特定時段的任務

3. **批次報表**
   - 對每個任務生成報表
   - 或使用 API 合併結果

### 資料匯出

**匯出格式**:

1. **CSV**: 原始資料表格
2. **JSON**: 結構化資料
3. **Excel**: 多工作表報表
4. **PDF**: 報表文件

**匯出方法**:

1. **透過 UI**:
   - Data Analysis 頁面的資料表格
   - 使用表格匯出功能

2. **透過 API**:
   - 使用相應的 API 端點
   - 程式化下載資料

### 自訂設定

**配置檔案**: `config/.env`

```ini
# API 設定
API_PORT=8000

# UI 設定
UI_PORT=8501

# 上傳限制
MAX_UPLOAD_SIZE=104857600  # 100MB

# 資料庫
DATABASE_PATH=data/atp_re.db
```

**修改設定**:

1. 編輯 `.env` 檔案
2. 重新啟動 ATP_Re
3. 設定即生效

---

## 最佳實踐 (Best Practices)

### 檔案管理

1. **檔案命名規範**
   ```
   格式: [日期]_[車次]_[類型].dat
   範例: 20241028_T1234_ATP.dat
   ```

2. **定期備份**
   - 備份 `data/atp_re.db`
   - 備份 `uploads/` 目錄
   - 備份重要報表

3. **清理舊檔案**
   - 定期清理不需要的上傳檔案
   - 匯出重要資料後可刪除原始檔

### 效能優化

1. **資料大小**
   - 單次處理 < 50MB 可獲最佳效能
   - 大檔案考慮分批處理

2. **記憶體管理**
   - 同時處理的任務 < 5 個
   - 完成的任務及時清理

3. **資料庫維護**
   - 定期備份資料庫
   - 必要時重建索引

### 安全性

1. **本地運行**
   - ATP_Re 僅監聽本地位址
   - 不暴露於外部網路

2. **資料保護**
   - 定期備份重要資料
   - 妥善保管資料庫檔案

3. **存取控制**
   - 控制誰可以存取應用程式目錄
   - 保護敏感資料檔案

### 故障排除

1. **檢查日誌**
   - 查看 `logs/` 目錄
   - 識別錯誤訊息

2. **重新啟動**
   - 遇到問題先嘗試重新啟動
   - 檢查是否有程序殘留

3. **資料庫修復**
   - 備份現有資料庫
   - 必要時建立新資料庫

---

## 鍵盤快捷鍵 (Keyboard Shortcuts)

### 瀏覽器快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| F5 | 重新整理頁面 |
| Ctrl+F | 搜尋頁面 |
| Ctrl+Plus | 放大介面 |
| Ctrl+Minus | 縮小介面 |
| Ctrl+0 | 重設縮放 |

### 應用程式控制

| 操作 | 方法 |
|------|------|
| 啟動系統 | 執行 ATP_Re 啟動器 |
| 停止系統 | Ctrl+C 或關閉控制台視窗 |
| 開啟 UI | 瀏覽器訪問 localhost:8501 |
| 查看 API | 瀏覽器訪問 localhost:8000/docs |

---

## 資料格式參考 (Data Format Reference)

### ATP 資料檔案格式

**支援格式**:
- 二進位格式 (.dat, .bin)
- 文字格式 (.log, .txt)
- 壓縮格式 (.zip)

**資料結構**:
```
[檔案標頭]
├─ 版本資訊
├─ 檔案類型
└─ 時間戳記

[資料區塊]
├─ 動態資料記錄
│   ├─ 時間戳記
│   ├─ 速度
│   ├─ 位置
│   └─ 狀態
├─ 事件記錄
│   ├─ 事件類型
│   ├─ 嚴重性
│   └─ 詳細資訊
└─ ...
```

---

## 附錄 (Appendix)

### 術語表 (Glossary)

| 術語 | 英文 | 說明 |
|------|------|------|
| ATP | Automatic Train Protection | 自動列車防護系統 |
| 任務 | Task | 處理工作單元 |
| 事件 | Event | 系統記錄的發生事項 |
| 報表 | Report | 分析結果文件 |
| 解碼 | Decode | 解析原始資料 |

### 聯絡支援 (Contact Support)

- **GitHub**: https://github.com/Lawliet0813/ATP_re/issues
- **Wiki**: https://github.com/Lawliet0813/ATP_re/wiki
- **Email**: [待提供]

### 版本資訊

- **文檔版本**: 1.0.0
- **最後更新**: 2024年
- **適用於**: ATP_Re v1.0.0

---

**感謝使用 ATP_Re！**

如有任何問題或建議，歡迎聯絡我們。
